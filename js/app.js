function createEl(t,e,i,s){var n=document.createElement(t);return 1!==e.nodeType&&(e=document.createTextNode(e)),n.appendChild(e),i&&(n.className=i),s&&(n.id=s),n}function getRandomInt(t,e){return Math.floor(Math.random()*(e-t+1))+t}function getRandomColor(){var t=["#FFCDD2","#E1BEE7","#D1C4E9","#C5CAE9","#BBDEFB","#B2DFDB","#F0F4C3","#FFECB3"],e=getRandomInt(0,t.length-1),i=t[e];return i}function setDB(){dbName="tuduDBv0.2",tuduDb=new DB;var t={tasks:[],lists:[]};tuduDb.connect(dbName,t)}function loadHome(){for(var t=document.getElementsByClassName("listsList-item"),e=t.length-1;e>=0;e--)listsList.removeChild(t[e]);var i=document.getElementById("loader");i.classList.add("loader-hidden");var s=document.getElementById("open-savelist-dialog-button"),n=tuduDb.getTable("lists");n.forEach(function(t){var t=t,e=createEl("li",t.name,"listsList-item",t.id);e.style.backgroundColor=t.color,e.addEventListener("click",function(){openList(t.id)}),listsList.insertBefore(e,s)})}function writeListTitle(t){taskListTitle.innerHTML="";var e=tuduDb.getRow(currentListInput.value,"lists");listViewHeader.style.backgroundColor=e.color;var i=document.createTextNode(e.name);taskListTitle.appendChild(i)}function setTabs(){listTabsButtons.forEach(function(t){t.classList.remove("listSection-actionButton-active")});var t=document.querySelector('.listSection-actionButton[value="'+filter.value+'"]');t.classList.add("listSection-actionButton-active")}function writeListTasks(){taskList.innerHTML="";var t=currentListInput.value,e=getTasksFromList(t,filter.value);if(e.length>0)e.forEach(function(t){var e=createEl("label",t.text,"list-item-label"),i=createEl("input","","list-item-check");i.setAttribute("type","checkbox"),i.addEventListener("click",function(){completeTask(t.id)});var s=createEl("button","","list-item-destroy");s.addEventListener("click",function(){deleteTask(t.id)});var n=createEl("li","","list-item",t.id);t.completed&&(n.classList.add("completed"),i.setAttribute("checked",!0)),n.appendChild(i),n.appendChild(e),n.appendChild(s),taskList.appendChild(n)});else{var i="There is nothing here.",s=createEl("p",i,"list-message");taskList.appendChild(s)}}function openList(t){listView.classList.add("listView-show"),currentListInput.value=t,writeListTitle(),setTabs(),writeListTasks()}function getTasksFromList(t,e){var e=e||"all",i=0,s=tuduDb.getTable("tasks"),n=[];return s.forEach(function(s){if(s.list===t){if("active"===e&&s.completed)return;if("completed"===e&&!s.completed)return;n.push(s),i++}}),n}function saveTask(t,e){e?tuduDb.updateRow(t,"tasks"):(t.completed=!1,t.list=currentListInput.value,tuduDb.addRow(t,"tasks")),tuduDb.save(),writeListTasks()}function completeTask(t){var e,i=tuduDb.getRow(t,"tasks");e=i.completed?{completed:!1}:{completed:!0},tuduDb.updateRow(e,t,"tasks"),tuduDb.save(),writeListTasks()}function deleteTask(t){tuduDb.removeRow(t,"tasks"),tuduDb.save(),writeListTasks()}function clearList(t){function e(){i.forEach(function(t){tuduDb.addRow(t,"tasks")}),tuduDb.save(),writeListTasks()}var i=getTasksFromList(t);i.forEach(function(t){tuduDb.removeRow(t.id,"tasks")}),tuduDb.save(),writeListTasks(),toast.action("List cleared.","Undo",e)}function deleteList(t){function e(){tuduDb.addRow(i,"lists"),tuduDb.save(),loadHome()}var i=tuduDb.getRow(t,"lists");tuduDb.removeRow(t,"lists"),tuduDb.save(),loadHome(),toast.action("List deleted.","Undo",e)}function saveList(t,e){e?tuduDb.updateRow(t,"lists"):tuduDb.addRow(t,"lists"),tuduDb.save(),loadHome(),toast.simple("List "+t.name+" created")}function Toast(t){function e(t){var e=createEl("div","",s),i=createEl("span",t,"toast-text");return e.appendChild(i),e}function i(e,i){setTimeout(function(){t.contains(e)&&t.removeChild(e)},i)}var t=t,s="toast";this.simple=function(s){var n=e(s);t.appendChild(n),i(n,3e3)},this.action=function(s,n,a){var o=e(s),r=createEl("button",n,"toast-action");r.addEventListener("click",function(){a(),t.removeChild(o)}),o.appendChild(r),t.appendChild(o),i(o,3e3)}}!function(){"use strict";function t(){function t(t){return JSON.stringify(t)}function e(t){return JSON.parse(t)}function i(){var t=(new Date).getTime();return t=t.toString()}this.dbName,this.data,this.connect=function(t,e){this.dbName=t,localStorage.getItem(this.dbName)?this.data=this.fetch():(this.data=e||{},this.save(e))},this.fetch=function(){return e(localStorage.getItem(this.dbName))},this.addTable=function(t){this.data[t]?console.error("Database error: table already exists."):this.data[t]=[]},this.addRow=function(t,e){this.data[e]?(t.id||(t.id=i()),this.data[e].push(t)):console.error("Database error: table doesn't exists")},this.getTable=function(t){return this.data[t]?this.data[t]:void console.error("Database error: table doesn't exists.")},this.getRow=function(t,e){for(var i,e=this.data[e],s=e.length-1;s>=0;s--)if(e[s].id===t){i=e[s];break}return i?i:void console.error("Database error: Row doesn't exists.")},this.updateRow=function(t,e,i){var s,i=this.data[i];if(i){for(var n=i.length-1;n>=0;n--)if(i[n].id===e){s=i[n];for(var a in t)s[a]=t[a];break}s||console.error("Database error: invalid row.")}else console.error("Database error: invalid table.")},this.removeRow=function(t,e){var i,e=this.data[e];if(e){for(var s=e.length-1;s>=0;s--)if(e[s].id===t){i=e[s],e.splice(s,1);break}i||console.error("Database error: invalid row.")}else console.error("Database error: invalid table.")},this.dropTable=function(t){delete this.data[t]},this.clear=function(){this.data={}},this.drop=function(){localStorage.removeItem(this.dbName)},this.save=function(){var e=t(this.data);localStorage.setItem(this.dbName,e)}}window.DB=t}();var dbName,tuduDb,listsList=document.getElementById("lists-list"),saveListDialog=document.getElementById("save-list-dialog"),listView=document.getElementById("list-view"),listViewHeader=document.getElementById("list-view-header"),listViewOptions=document.getElementById("list-view-options"),taskListTitle=document.getElementById("task-list-title"),taskList=document.getElementById("task-list"),currentListInput=document.getElementById("current-list-input"),filter=document.getElementById("current-list-filter"),tasksInput=document.getElementById("new-task-input");tasksInput.addEventListener("focus",function(){this.parentElement.classList.add("newTask-active")}),tasksInput.addEventListener("blur",function(){this.parentElement.classList.remove("newTask-active")}),tasksInput.onkeyup=function(t){if(13==t.keyCode){var e=this.value.trim();if(""!==e){var i={text:e};saveTask(i),this.value=""}}};var saveListButton=document.getElementById("save-list-button");saveListButton.addEventListener("click",function(){var t=saveListInput.value.trim();if(""!==t){var e=getRandomColor(),i={name:t,color:e};saveList(i),saveListInput.value="",saveListDialog.classList.remove("dialog-visible")}});var saveListInput=document.getElementById("save-list-input");saveListInput.addEventListener("focus",function(){this.parentElement.classList.add("newList-fromGroup-active")}),saveListInput.addEventListener("blur",function(){this.parentElement.classList.remove("newList-fromGroup-active")}),saveListInput.onkeyup=function(){13==event.keyCode&&saveListButton.click()};var dialogs=document.querySelectorAll("[data-dialog]");dialogs.forEach(function(t){t.addEventListener("click",function(t){t.stopPropagation()})});var openDialogButtons=document.querySelectorAll("[data-dialog-open]");openDialogButtons.forEach(function(t){t.addEventListener("click",function(t){t.stopPropagation();var e=this.getAttribute(["data-dialog-open"]),i=document.querySelector("[data-dialog="+e+"]");i.classList.add("dialog-visible")})});for(var closeDialogButton=document.getElementsByClassName("dialog-closeButton"),i=closeDialogButton.length-1;i>=0;i--)closeDialogButton[i].addEventListener("click",function(){var t=this.getAttribute(["data-dialog-close"]),e=document.querySelector("[data-dialog="+t+"]");e.classList.remove("dialog-visible")});var closeListViewButton=document.getElementById("close-list-view");closeListViewButton.addEventListener("click",function(){listView.classList.remove("listView-show")});var moreListOptionsButton=document.getElementById("more-list-options");moreListOptionsButton.addEventListener("click",function(t){t.stopPropagation(),listViewOptions.classList.toggle("listView-options-show")});var clearListButton=document.getElementById("clear-list");clearListButton.addEventListener("click",function(){clearList(currentListInput.value)});var deleteListButton=document.getElementById("delete-list");deleteListButton.addEventListener("click",function(){listView.classList.remove("listView-show"),deleteList(currentListInput.value)});var listTabsButtons=document.querySelectorAll(".listSection-actionButton");listTabsButtons.forEach(function(t){t.addEventListener("click",function(){var t=this.value;filter.value=t,setTabs(),writeListTasks()})});var mainNav=document.getElementById("main-nav"),mainNavContent=document.getElementById("main-nav-content");mainNavContent.addEventListener("click",function(t){t.stopPropagation()});var menuButton=document.getElementById("menu-button");menuButton.addEventListener("click",function(t){t.stopPropagation(),this.classList.toggle("menuButton-open"),mainNav.classList.toggle("mainNav-open")}),document.body.addEventListener("click",function(){mainNav.classList.remove("mainNav-open"),dialogs.forEach(function(t){t.classList.remove("dialog-visible")}),listViewOptions.classList.remove("listView-options-show")});var toastContainer=document.getElementById("toast-container"),toast=new Toast(toastContainer);document.body.onload=function(){setDB(),loadHome()},"serviceWorker"in navigator&&(navigator.serviceWorker.register("./sw.js").then(function(t){console.log("Succsessfully regitered service worker",t)}).catch(function(t){console.warn("Error whilst registering service worker",t)}),navigator.serviceWorker.ready.then(function(t){console.log("Service worker ready")}));